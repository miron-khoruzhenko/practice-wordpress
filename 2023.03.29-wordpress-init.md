# Intro

[download wordpress](https://ru.wordpress.org/download/)

- [Intro](#intro)
  - [Полезные ссылки](#полезные-ссылки)
  - [FAQ](#faq)
- [Wordpress Initialization](#wordpress-initialization)
  - [Первые шаги](#первые-шаги)
    - [Создание базы данных](#создание-базы-данных)
    - [Установка Wordpress](#установка-wordpress)
- [Создание тем](#создание-тем)
  - [Натяжка сайта на движок Wordpress](#натяжка-сайта-на-движок-wordpress)
  - [Правильная структура темы](#правильная-структура-темы)
  - [Хуки (functions / filters) - не закончено урок 7](#хуки-functions--filters---не-закончено-урок-7)
- [Динамическое изменение сайта](#динамическое-изменение-сайта)
  - [Динамическое лого](#динамическое-лого)
    - [**Если все же нужно использовать ссылку?**](#если-все-же-нужно-использовать-ссылку)
  - [Динамический контент и плагины](#динамический-контент-и-плагины)
  - [Настройка групп полей](#настройка-групп-полей)
  - [Связывание групп полей на разных страницах](#связывание-групп-полей-на-разных-страницах)

## Полезные ссылки 

* [phpMyAdmin](http://localhost/phpMyAdmin/)
* [Wordpress скрипты и документация](https://wp-kama.ru/)
* [Wordpress theme generator](https://underscores.me/)
* [Репозиторий с рабочими картинками (если их не видно)](https://github.com/miron-khoruzhenko/my-notes)

## FAQ

- Если картинок не видно то значит это вторая копия записей. Для оригинала смотри репо с записками
- Если есть проблемы с записью файлов смотри эти команды:

```bash
# Для работы гит
git config --global --add safe.directory /var/www/html/childhood

# Для разрешения записи vs code и админки wordpress
sudo chown -R apache:strewen /var/www/html/childhood

# Для рекурсивной выдачи прав на запись и изменение.
sudo chmod -R 775 childhood  

```



# Wordpress Initialization

## Первые шаги 

После скачивания архива и перемещения всех файлов в рабочий проект мы запускаем наш сервер. Для этого я запустил локальный хост и перенес в его папку нашу папку проекта. После мы переходим на адрес `http://localhost/childhood` и нас встречает такой экран

![welcome](./assets/2023.03.29-wordpress-welcome.jpg)

После нужно установить phpMyAdmin 

```bash
sudo dnf install phpMyAdmin php-mysqlnd php-mcrypt php-php-gettext
```

и работать он будет по адресу `http://localhost/phpMyAdmin/`.

Так как я скорее всего из за своей глупости потерял пароль то мне пришлось его перезаписать (Если забуду то новый лежит в папке документов). Для этого в терминале нужно прописать:

```bash
sudo mysqladmin -u root password newpassword
# замени newpassword на новый пароль
systemctl restart mysqld
```

и после этого можно войти в систему исользуя `root` и `newpassword` в качестве логина и пароля соответственно. После этого нас встретит такой экран

![phpMyAdminHomepage](./assets/2023.03.29-phpMyAdmin-homepage.jpg)

### Создание базы данных

Теперь на вкладке **Базы данных** создаем новую. Вводим имя нашей базы данных и выбираем кодировку `utf8_general-ci`. 

После нужно добавить пользователя для этой базы. Переходим во вкладку привилегии и заполняем форму. В области `Login Information` вводим имя и пароль, в `Database for user account` отмечаем третью галочку *Grant all privileges on database name*, в `Global Privileges` выбираем **Check all**. После внизу нажимаем кнопку **Go**

И так мы создали базу данных и можем продолжить работать с **Wordpress**.

### Установка Wordpress

Мы вернулись к нашей странице **Wordpress** которая у меня находится по адресу `http://localhost/childhood/`. В форме заполняем все нужные места и нажимаем далее.

![form1](./assets/2023.04.01-wordpress-welcome-fulled.jpg)

Там мы видим либо соощение о том что все хорошо либо сообщение об ошибке. Если есть сообщение об ошибке которое просит нас создать `wp-config.php` то просто так и делаем. Создаем `wp-config.php` рядом с `wp-config-sample.php`. Пример текста есть как на экране ошибки так и в самом `wp-config-sample.php`. После этого нажимаем **Запустить установку**.

![form2](./assets/2023.04.01-wordpress-installation-form.jpg)

Вводим нужные данные и нажимаем установить **Wordpress**. На этом наша установка закончена. Теперь мы можем ввойти используя наши данные. Если все сделанно правильно то после входа нас встретит вот такая страница.

![homepage](./assets/2023.04.01-wordpress-homepage.jpg)

**Что бы позже сюда вернуться, можно прописать в адресной строке `localhost/childhood/wp-admin`**

# Создание тем

Есть разные подходы в создании темы. Например создания тем с помощью тем генератора или создания тем с нуля. Что бы увидеть весь процес создания, сначала мы создадим тему с нуля.

Для начала создадим пустую папку с темой. Для этого создаем папку в `./wp-content/themes`. Я называю ее **childhoodtheme**. Теперь что бы убедится что она видна для **wordpress**'a можно зайти вов вкладку **Внешний вид** и там под темами увидеть поврежденную тему. Если она есть то все сделанно правильно.

![damagedTheme](./assets/2023.04.11-damaged-theme.jpg)

Эта тема работает правильно просто пока она не зарегестрированна и у нее отсутсвуют кое какие нужные файлы. Для начала что бы зарегистрировать эту тему нам нужно создать файл `css` и добавить туда комментарий который описывает эту тему. Вот пример такого комментария взятого из уже готовой темы.

```css
/*
Theme Name: Twenty Twenty-One
Theme URI: https://wordpress.org/themes/twentytwentyone/
Author: the WordPress team
Author URI: https://wordpress.org/
Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. With new block patterns, which allow you to create a beautiful layout in a matter of seconds, this theme’s soft colors and eye-catching — yet timeless — design will let your work shine. Take it for a spin! See how Twenty Twenty-One elevates your portfolio, business website, or personal blog.
Requires at least: 5.3
Tested up to: 6.2
Requires PHP: 5.6
Version: 1.8
License: GNU General Public License v2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: twentytwentyone
Tags: one-column, accessibility-ready, custom-colors, custom-menu, custom-logo, editor-style, featured-images, footer-widgets, block-patterns, rtl-language-support, sticky-post, threaded-comments, translation-ready

Twenty Twenty-One WordPress Theme, (C) 2020 WordPress.org
Twenty Twenty-One is distributed under the terms of the GNU GPL.
*/
```

Однако нам для создания темы хватит и одного ее имени. Вот комментарий который я добавил в `css`

```css
/*
Theme Name: Childhood Theme
*/
```
Теперь для создания темы осталось создать только еще один файл, `index.php`. Пока что можно оставить его пустым. После обновления страницы можно увидеть нашу тему среди рабочих тем

![WorkingTheme](./assets/2023.04.11-our-working-themes.jpg)

## Натяжка сайта на движок Wordpress

Теперь можно начать наполнять наш сайт контентом. Дя этого мы будем использовать обычный сайт сделанный с помощью `html css js` и натянем его на двжок **WP**.

	Исходники в /home/strewen/Desktop/vscode_projects/Web/Vanillia/2023.04.15-childhood-wp-source

копируем все файлы с исходника `index.html` в `index.php`. Так же создаем в папке темы папку **assets** куда копируем все остальные иходники. В итоге у меня получилась такая структура.

```bash
└── assets
    ├── fonts
    ├── img
    │   ├── favicons
    │   └── icons
    │       └── svg
    ├── js
    └── styles
```

После в `index.php` мы добавляем тег `php` и инициализируем наш **WP**

```html
<?php 
	wp_head()
?>
```
Так же из за отличий структуры проекта **WP** и обычной верстки все наши относительные пути ломаются и нам нужно задать их подругому. 

![wrongPath](./assets/2023.04.17-worng-path.jpg)

Сначала можно удалить тег ссылки на файл стилей. Их в **WP** мы будем импортировать по другому.

```html
<!-- <link rel="stylesheet" href="./styles/main.min.css"> -->
```

Копируем все стили из этого файла в наш основной файл стилей. Потом создаем файл с хуками (функциями) для импорта стилей который я назову `function.php`. 

>Хуки это действия которые выполняются во время других действий.

Потом вводим этот код.

```html
<?php

//* Добавляем какое то действие. Первым аргументом мы добавляем какой то хук а вторым вызываемую функцию
add_action('wp_enqueue_scripts', 'childhood_scripts');

function childhood_scripts() {
	//* Подключение основного файла css который уже отслеживает wordpress. Первым аргументом мы задаем id этого файла
	wp_enqueue_style('childhood-style', get_stylesheet_uri());

	// *Подключение внешного стиля. Что бы не писать полный путь, получаем путь до папки темы с помощью функции
	//* Функция дает нам путь до темы и через точку конкатинируем с оставшимся путем

	// wp_enqueue_style('button-style', get_template_directory_uri() . '/assets/styles/buttons.css');
}

?>
```

Таким образом мы добавили скрипты. Теперь же можно добавить скрипты. Для этого в конце нашего `index.php` добавляем еще один блок `php` и в нем вызываем функцию `wp_footer();`. Так же дополняем наш файл со скриптами что бы добавить туда скрипт: 

```html
<?php
//* Добавляем какое то действие. Первым аргументом мы добавляем какой то хук а вторым вызываемую функцию
add_action('wp_enqueue_scripts', 'childhood_styles');
add_action('wp_enqueue_scripts', 'childhood_scripts');

function childhood_styles() {
	//* Подключение основного файла css который уже отслеживает wordpress. Первым аргументом мы задаем id этого файла
	wp_enqueue_style('childhood-style', get_stylesheet_uri());

	// *Подключение внешного стиля. Что бы не писать полный путь, получаем путь до папки темы с помощью функции
	//* Функция дает нам путь до темы и через точку конкатинируем с оставшимся путем
	// wp_enqueue_style('button-style', get_template_directory_uri() . '/assets/styles/buttons.css');	
}

function childhood_scripts() {
	// wp_enqueue_scripts(name_id, path, dependencies_array, version, in_footer);
	wp_enqueue_script	('childhood-script', get_template_directory_uri() . '/assets/js/main.min.js',	array(), null, true);
}
?>
```

Теперь заменим оставшиеся пути в `index.php` и `style.css`. Делать мы это будем с помощью встроенной функции редактора **Ctrl + F** и с ее помощью находим все `./img` в `index.php` и заменяем их на `<?php echo bloginfo('template_url'); ?>/assets/img/`. 

```html
    <link rel="apple-touch-icon" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="180x180" href="<?php echo bloginfo('template_url'); ?>/assets/img//favicons/apple-touch-icon-180x180.png">
```

После находим все `../img` в `style.css` и заменяем их все на `assets/img`, а `../fonts` на `assets/font`. 

> Функция `bloginfo()` похожа на функции которые мы исопльзовали до этого. в **WP** много похожих функций и нет большой разницы какие использовать.

## Правильная структура темы

Перейти в генератор шаблона тем можно нажав [cюда](https://underscores.me/) 

В генераторе темы мы можем создать начальный шаблон для нашей темы **WP**. Там сразу задана правильная структура и во время создания темы мы будем рассматривать и копировать готовые решения оттуда. Для начала в нашей готовой теме мы можем создать два отдельных компонента `header.php` и `footer.php`.

Туда мы переносим части кода ответственную за **Header** и **Footer** соответственно. Нужно это для того что бы не копировать один и тот же код во все файлы а просто вызывать готовое решение. Теперь же что бы вызвать **header** или **footer** можно написать соответственно:

```html
<?php
	get_header();
?>

<?php
	get_footer();
?>
```

## Хуки (functions / filters) - не закончено урок 7

Хуки это действия которые выполняются после или во время каких то событий.

В **WP** с помощью `php` мы можем создавать и вызывать функции. Для создания функции мы можем использовать такую запись

```html
function print_hello(){
	echo 'test1' . '<br>';
}
```

далее что бы 

# Динамическое изменение сайта

Динамическое изменение позволяет нам изменять сайт с помощью админки **WP**. Быстро менять элементы на сайте такие как картинки, надписи, лого и т.д.

## Динамическое лого

Начнем с настройки динамического лого. На странице админки **WP** идем в `Внешний вид -> Настроить`.

Там перед напи на боковой панели будут имя нашей темы и ее настройки. В **Свойства сайта** можно изменить название и краткое описание нашего сайта. ак же можно настроить лого для нашего сайта но сначала нужно включить эту возможность. Для этого мы в файле наших вызываем функцию:

```html
add_theme_support('custom-logo');
```

Теперь выше всех свойст сайта у нас появляется кнопка для выбора логотипа. Нажав на нее можно загрузить наше лого.

Теперь что бы в верстке выделить место под лого в файле `header.php` мы заменяем `<a href='#' class="header__logo">...</a>` на:

```html
<div class="header__logo">
		<?php the_custom_logo(); ?>
</div>
```

и то же самое делаем в `footer.php`

```html
<a href="#" class="footer__logo">
	<img src="<?php echo bloginfo('template_url'); ?>/assets/im/icons/svg/logo.svg" alt="мир детства" class="footer__logo-img">
	<div class="footer__logo-text">мир детства</div>
</a>
```

заменяем на:

```html
<div href="#" class="footer__logo">
	<?php the_custom_logo(); ?>
</div>
```

Далее можно загрузить наше лого выбрав его на компьютере (обрезав на выбор) и нажать опубликовать.

### **Если все же нужно использовать ссылку?**

В таком случае нам нужно просто получить **URL** логотипа. Заходим на сайт с документацией и в описании функции `get_custom_logo()` (это функция на основе которой работет `the_custom_logo()`) копируем код для вывода **URL** картинки.

Так же в ссылку добавляем ссылку на домашную страницу. 

```html
<a href="<?php echo get_home_url(); ?>" class="header__logo">
	<img src="<?php 
	// получаем ссылку на логотип
	$custom_logo__url = wp_get_attachment_image_src( get_theme_mod( 'custom_logo' ), 'full' ); 
	// выводим
	echo $custom_logo__url[0];  
	?>" alt="мир детства" class="header__logo-img">
</a>
```

По такой же логике используюя функцию `bloginfo();` мы можем динамически изменить название нашего сайта

```html
<title>
	<?php bloginfo('name'); echo " | "; bloginfo('description') ?>
</title>
```

Точно так же можно изменить любую часть сайта.

## Динамический контент и плагины

Теперь же что бы так же легко добавлять дополнительные поля, картинки и тексты с помощью админки мы устанавливаем и активируем плагин **Advanced Custom Fields** (далее ACF).

После установки сбоку у нас появится вкладка **ACF**. Нажимаем и попадаем на вкладку группы полей. Теперь добавляем новую группу полей. 

На странице создания группы полей перед нами есть две вкладки, **Поля** - для добовления новых полей и **Настройки** - для настроек этой группы полей.

![new-field-group](./assets/2023.05.01-new-field-group.jpg)

Теперь мы будем настраивать группу для замены нашего блока **"Про компанию"** что бы сделать его динамически изменяемым в **WP**.

![about-block](assets/2023.05.01-about-block.jpg)

В заголовок имени полей пишем **"Про компанию"** начинаем настройки полей: 

* Настройки поля под заголовок:
  * **General**
    * Тип поля: Текст
    * Ярлык поля: Заголовок в описании компании
    * Название поля: about_title
  * **Validation**
    * Обязательное: True
    * Ограничение символов: 30
  * **Presentation**
    * Инструкции: Укажите заголовок
* Второе поле для описания: 
  * **General**
    * Тип поля: Область текста
    * Ярлык поля: Описание компании
    * Название поля: about_descr
  * **Validation**
    * Обязательное: True
  * **Presentation**
    * Ряды: 8
    * Перевод строк: добавление \<br\>
* Третье поле для изображения
  * **General**
    * Тип поля: Изображение
    * Ярлык поля: Изображение для презентации
    * Название поля: about_img
    * Возвращаемый формат: URL изображения
    * Библиотека: Все  
  * **Validation**
    * Обязательное: True
  * **Presentation**
    * Размер изображения: Полный размер

В качестве настройки группы всего лишь меняет правила расположения:

* Location
  * Правила: Тип страницы == Главная страница

Теперь переходим во вкладку **Страницы** и оттуда на **"Главная Страница"**. Там удаляем все ненужные блоки и после видим что внизу страницы есть форма полей которые мы только что создали. Туда вводим все данные из блока **About**.  

![about-block](assets/2023.05.01-about-block.jpg)

При загрузке изображения в качестве атрибута **alt** пишем **"Про компанию"** и после нажимаем обновить. 

Теперь мы закончили приготовления и осталось только добавить место для отображения этих полей в нашем `index.php`. Для этого переходим в `index.php` и находим наш блок **about** (Можно найти по id). Теперь сначала меняем наш заголовок вызывая `the_field()` функцию передавая туда заданное ранее название поля. 

```html
// До
...
<h1 class="title underlined">Про компанию</h1>
...

// После
<h1 class="title"><?php the_field('about_title'); ?></h1>
```

То же самое делаем для описания и изображения. Кстати так как мы указали возвращяемый формат для изображения URL то он и будет нам возвращен. То есть возвращеное значение нужно подставить в **src**. Вот конечный блок нашего кода:

```html
<div class="about" id="about">
    <div class="container">
        <div class="row">
            <div class="col-md-10 offset-md-1 col-lg-5 offset-lg-1">
                <div class="about__img">
                    <img src="<?php the_field('about_img') ?>" alt="про компанию">
                </div>
            </div>
            <div class="col-md-10 offset-md-1 offset-lg-0 col-lg-6 col-xl-5 offset-xl-1">
                <h1 class="title underlined"><?php the_field('about_title')?></h1>
                <div class="about__text">
                    <?php the_field('about_descr') ?>
                </div>
                <a href="#" class="button">Узнать больше</a>
            </div>
        </div>
    </div>
</div>
```

Теперь если обновим и посмотрим на страницу то увидим что ничего не изменилось. Это значит что данные правильно приходят с сервера. Можно попробовать изменить данные через админку в **WP** в форме на **Главной странице**.

Теперь же если мы укажем в настройках нашей админки что хотим **массив изображений** а не **URL** то вот так мы можем его использовать.

```html
<div class="about__img">
  <!-- <img src="<?php the_field('about_img') ?>" alt="про компанию"> -->
  <?php
    $image = get_field('about_img');
    
    if (!empty($image)): ?>

      <img 
        src="<?php echo $image['url']; ?>" 
        alt="<?php echo $image['alt']; ?>"/>

  <?php endif;
    print('Array info:<br/>');
    // print($image . '<br/>');
    // print_r($image);
    print("<pre style='font-size: 10px;'>" . print_r($image,true)."</pre>");
  ?>
</div>
```

Теперь немного размерем этот код. С помощью функции `get_field()` мы запрашиваем данные из поля с именим **'about_img'** и сохраняем их в переменную.

```php
$image = get_field('about_img');
```

Потом проверяем пришли ли эти данные в переменную и если да то добавляем тег изображения передавая туда нужные данные.

```php
if (!empty($image)): ?>

    <img 
    src="<?php echo $image; ?>" 
    alt=""/>
```

Позже закрываем наш блок **if**. Последующий код нужен только для того что бы посмотреть что содержит переменная. Однако и там есть несколько способов вывода.

```php
// Простой вывод однако не выводит содержимое Array
print('Array info:<br/>'); 
// print($image . '<br/>'); // Array

// Для вывода содержимого можно использовать эту функцию однако она выводи Raw Data
// print_r($image);

// Однако такая комбинация функций даст нам красивый вывод
print("<pre style='font-size: 10px;'>" . print_r($image,true)."</pre>");
```

Получается вот такой вывод:

![pretty output](assets/2023.05.02-pretty-output.jpg)

> Таким образом мы изменили **src** у тега **img**. Однако что бы изменять подобные данные в **CSS** мы должны использовать **inline** стили. По этому изначально верстка содержит некоторые **inline** стили.

## Настройка групп полей

Иногда при работе с полями, полей которые мы должны заполнить становится слишком много. Что бы сделать более хороший вид мы можем разделить эти поля на вкладки. Для этого во вкладке **Группа Полей** нужно войти в любую группу и там добавить **Поле** с типом поля **Вкладка** и поместить ее наверх полей которые она должна скрывать.

Для примера создадим две вкладки и посмотрим как они будут выведены:

![first fieild](assets/2023.05.02-fields.jpg)
![second fieild](assets/2023.05.02-fields-2.jpg)

Это очень удобно для разделения полей на логические блоки когда полей становится слишком много.

## Связывание групп полей на разных страницах

При создании группы полей мы вынужденно создаем простую логику где именно нужно вывести эти группы полей. Но если есть информация которая на всех страницах одинаковая то за место того что бы создавать такие формы отдельно на каждой странице можно настроить одно кастомное поле для одной страницы например для главной и потом просто повторять на каждой странице с указанием того что информация берется с главной страницы.

Что бы создать такую логику, переходим в **ACF** и создаем новую группу полей. Я даю этой группе название **"Общая информация по сайту"** и настраиваю отображение страницы на главной. После создаю первое поле для почты и настраиваю его. После того как наше поле готово мы заполняем его на главной странице и идем в `header.php`.

В файле `header.php` мы находим место под почту и вместо почты пишем такой код:

```php
<?php the_field('mail', 2); ?>
```

Первый аргумент нам уже известен и отвечает за селектор элемента а второй аргумент отвечает за **ID** страницы. **ID** страницы мы можем найти во время редактирования страницы в поле **URL**. 

![page id](assets/2023.05.02-page-id.jpg)

Теперь точно таким же образом можно изменить все остальные элементы у футера и хедера.